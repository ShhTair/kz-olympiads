<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">–£—á–∞—Å—Ç–Ω–∏–∫ | –ë–∞–∑–∞ –û–ª–∏–º–ø–∏–∞–¥–Ω–∏–∫–æ–≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <div class="gradient-bg text-white py-8">
        <div class="max-w-5xl mx-auto px-4">
            <a href="/" class="text-sm opacity-75 hover:opacity-100 mb-4 inline-block">‚Üê –ù–∞–∑–∞–¥ –∫ –±–∞–∑–µ</a>
            <h1 class="text-3xl font-bold mb-2" id="participantName">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
            <p class="text-lg opacity-90" id="participantNameRu"></p>
        </div>
    </div>

    <div class="max-w-5xl mx-auto px-4 py-8">
        <!-- Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8" id="statsGrid">
            <!-- Will be populated -->
        </div>

        <!-- Participations -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold mb-6">üèÜ –£—á–∞—Å—Ç–∏—è –≤ –æ–ª–∏–º–ø–∏–∞–¥–∞—Ö</h2>
            <div id="participationsList" class="space-y-4">
                <!-- Will be populated -->
            </div>
        </div>

        <!-- Official Links -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold mb-6">üîó –°—Å—ã–ª–∫–∏ –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
            <div id="officialLinks" class="space-y-2">
                <!-- Will be populated -->
            </div>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const olympiad = urlParams.get('olympiad');
        const name = urlParams.get('name');

        async function loadParticipant() {
            if (!olympiad || !name) {
                document.getElementById('participantName').textContent = '–£—á–∞—Å—Ç–Ω–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω';
                return;
            }

            try {
                let data = null;
                if (olympiad === 'imo') {
                    const res = await fetch('/data/imo-kazakhstan.json');
                    const imoData = await res.json();
                    data = imoData.notableParticipants.find(p => p.name === name);
                    if (data) {
                        renderIMOParticipant(data);
                    }
                } else if (olympiad === 'ioi') {
                    const res = await fetch('/data/ioi-kazakhstan.json');
                    const ioiData = await res.json();
                    data = ioiData.topScorers.find(p => p.name === name);
                    if (data) {
                        renderIOIParticipant(data);
                    }
                }

                if (!data) {
                    document.getElementById('participantName').textContent = '–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã';
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('participantName').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
            }
        }

        function renderIMOParticipant(p) {
            document.getElementById('pageTitle').textContent = `${p.name} | IMO Kazakhstan`;
            document.getElementById('participantName').textContent = p.name;
            document.getElementById('participantNameRu').textContent = p.nameRu;

            // Stats
            const goldCount = p.medals.filter(m => m.includes('Gold')).length;
            const silverCount = p.medals.filter(m => m.includes('Silver')).length;
            const bronzeCount = p.medals.filter(m => m.includes('Bronze')).length;
            const maxScore = Math.max(...p.scores);

            document.getElementById('statsGrid').innerHTML = `
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-600 mb-1">–£—á–∞—Å—Ç–∏–π</div>
                    <div class="text-3xl font-bold text-purple-600">${p.years.length}</div>
                    <div class="text-xs text-gray-500 mt-1">${p.years[0]}-${p.years[p.years.length-1]}</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-600 mb-1">–ú–µ–¥–∞–ª–µ–π</div>
                    <div class="text-3xl font-bold text-blue-600">${p.medals.length}</div>
                    <div class="text-xs text-gray-500 mt-1">ü•á${goldCount} ü•à${silverCount} ü•â${bronzeCount}</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-600 mb-1">–õ—É—á—à–∏–π –±–∞–ª–ª</div>
                    <div class="text-3xl font-bold text-green-600">${maxScore}</div>
                    <div class="text-xs text-gray-500 mt-1">–∏–∑ 42 –≤–æ–∑–º–æ–∂–Ω—ã—Ö</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-600 mb-1">–û–ª–∏–º–ø–∏–∞–¥–∞</div>
                    <div class="text-2xl font-bold text-gray-700">IMO</div>
                    <div class="text-xs text-gray-500 mt-1">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</div>
                </div>
            `;

            // Participations
            const participations = p.years.map((year, i) => {
                const medal = p.medals[i] || '–£—á–∞—Å—Ç–∏–µ';
                const score = p.scores[i] || '-';
                const medalColor = medal.includes('Gold') ? 'yellow' : 
                                   medal.includes('Silver') ? 'gray' : 
                                   medal.includes('Bronze') ? 'orange' : 'blue';
                
                return `
                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-semibold text-lg">IMO ${year}</div>
                                <div class="text-sm text-gray-600 mt-1">–ë–∞–ª–ª: ${score} / 42</div>
                            </div>
                            <div>
                                <span class="px-3 py-1 bg-${medalColor}-100 text-${medalColor}-700 rounded-full font-semibold">${medal}</span>
                            </div>
                        </div>
                        <a href="https://www.imo-official.org/year_individual_r.aspx?year=${year}" target="_blank" 
                           class="text-sm text-purple-600 hover:underline mt-2 inline-block">
                            –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã IMO ${year} ‚Üí
                        </a>
                    </div>
                `;
            }).join('');

            document.getElementById('participationsList').innerHTML = participations;

            // Official links
            document.getElementById('officialLinks').innerHTML = `
                <a href="https://www.imo-official.org/participant_r.aspx?id=${p.name.replace(' ', '%20')}" 
                   target="_blank" class="block text-purple-600 hover:underline">
                    üîó –ü—Ä–æ—Ñ–∏–ª—å –Ω–∞ IMO Official (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
                </a>
                <a href="https://www.imo-official.org/country_team_r.aspx?code=KAZ" 
                   target="_blank" class="block text-purple-600 hover:underline">
                    üá∞üáø –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–±–æ—Ä–Ω–æ–π –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞ –Ω–∞ IMO
                </a>
                ${p.notes ? `<div class="mt-4 p-4 bg-blue-50 rounded-lg"><div class="text-sm text-gray-700">‚ÑπÔ∏è ${p.notes}</div></div>` : ''}
            `;
        }

        function renderIOIParticipant(p) {
            document.getElementById('pageTitle').textContent = `${p.name} | IOI Kazakhstan`;
            document.getElementById('participantName').textContent = p.name;
            document.getElementById('participantNameRu').textContent = p.nameRu;

            // Stats
            const goldCount = p.medals.filter(m => m.includes('Gold')).length;
            const silverCount = p.medals.filter(m => m.includes('Silver')).length;
            const bronzeCount = p.medals.filter(m => m.includes('Bronze')).length;
            const maxScore = Math.max(...p.scores);

            document.getElementById('statsGrid').innerHTML = `
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-600 mb-1">–£—á–∞—Å—Ç–∏–π</div>
                    <div class="text-3xl font-bold text-purple-600">${p.years.length}</div>
                    <div class="text-xs text-gray-500 mt-1">${p.years[0]}-${p.years[p.years.length-1]}</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-600 mb-1">–ú–µ–¥–∞–ª–µ–π</div>
                    <div class="text-3xl font-bold text-blue-600">${p.medals.length}</div>
                    <div class="text-xs text-gray-500 mt-1">ü•á${goldCount} ü•à${silverCount} ü•â${bronzeCount}</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-600 mb-1">–õ—É—á—à–∏–π –±–∞–ª–ª</div>
                    <div class="text-3xl font-bold text-green-600">${maxScore.toFixed(0)}</div>
                    <div class="text-xs text-gray-500 mt-1">–∏–∑ 600 –≤–æ–∑–º–æ–∂–Ω—ã—Ö</div>
                </div>
                <div class="bg-white rounded-lg shadow p-4">
                    <div class="text-sm text-gray-600 mb-1">–û–ª–∏–º–ø–∏–∞–¥–∞</div>
                    <div class="text-2xl font-bold text-gray-700">IOI</div>
                    <div class="text-xs text-gray-500 mt-1">–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞</div>
                </div>
            `;

            // Participations
            const participations = p.years.map((year, i) => {
                const medal = p.medals[i] || '–£—á–∞—Å—Ç–∏–µ';
                const score = p.scores[i] || '-';
                const medalColor = medal.includes('Gold') ? 'yellow' : 
                                   medal.includes('Silver') ? 'gray' : 
                                   medal.includes('Bronze') ? 'orange' : 'blue';
                
                return `
                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-semibold text-lg">IOI ${year}</div>
                                <div class="text-sm text-gray-600 mt-1">–ë–∞–ª–ª: ${score} / 600</div>
                            </div>
                            <div>
                                <span class="px-3 py-1 bg-${medalColor}-100 text-${medalColor}-700 rounded-full font-semibold">${medal}</span>
                            </div>
                        </div>
                        <a href="https://stats.ioinformatics.org/olympiads/${year}" target="_blank" 
                           class="text-sm text-purple-600 hover:underline mt-2 inline-block">
                            –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã IOI ${year} ‚Üí
                        </a>
                    </div>
                `;
            }).join('');

            document.getElementById('participationsList').innerHTML = participations;

            // Official links
            document.getElementById('officialLinks').innerHTML = `
                <a href="https://stats.ioinformatics.org/people/" 
                   target="_blank" class="block text-purple-600 hover:underline">
                    üîó –ü–æ–∏—Å–∫ –Ω–∞ IOI Statistics
                </a>
                <a href="https://stats.ioinformatics.org/results/KAZ" 
                   target="_blank" class="block text-purple-600 hover:underline">
                    üá∞üáø –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–±–æ—Ä–Ω–æ–π –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞ –Ω–∞ IOI
                </a>
                ${p.notes ? `<div class="mt-4 p-4 bg-blue-50 rounded-lg"><div class="text-sm text-gray-700">‚ÑπÔ∏è ${p.notes}</div></div>` : ''}
            `;
        }

        loadParticipant();
    </script>
</body>
</html>
